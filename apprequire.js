/**
 * AppRequire - http://code.tolsma.net/apprequire
 * Copyright(c) 2010 Sander Tolsma/TTC
 * licensing@tolsma.net
 * http://code.tolsma.net/licenses
 */
(function(){var a=this,H,h=a.document,D=h.getElementsByTagName("head")[0]||h.getElementsByTagName("body")[0],T=!!a.ActiveXObject,o="_",s="#",u="LOADING",k="LOADED",c="DEPENDENCY",q="DEFINED",m="READY",v="LOADERROR",C="WAITING",y={},z={},R,n=[],J=[],g=[],x=null,K=[];function w(X){var W=Object.prototype.toString;return W.apply(X)==="[object Array]"}function r(X,W){return X===null||X===undefined||((w(X)&&!X.length))||(!W?X==="":false)}function Q(aa,Z,Y){if(r(aa,true)){return}for(var X=0,W=aa.length;X<W;X++){if(Z.call(Y||aa[X],aa[X],X,aa)===false){return X}}}function f(Y,X,W){if(r(Y)){return}if(w(Y)||Y.callee){Q(Y,X,W);return}else{if(typeof Y=="object"){for(var Z in Y){if(Y.hasOwnProperty(Z)){if(X.call(W||Y,Z,Y[Z],Y)===false){return}}}}}}function U(Y,X,W){for(var Z in X){if(!(Z in Y)||W){Y[Z]=X[Z]}}}function N(aa,ab){if((ab.charAt(ab.length-1)==="/")&&(ab.length>1)){ab=ab.substr(0,ab.length-1)}var W=L(aa),X,Y;if(ab.charAt(0)==="/"){return V(W,ab)}X=L(ab);X.directory="";if(V(X,"")!==""){return ab}X=(W.path==="")?[]:W.path.split("/");X=X.concat(ab.split("/"));for(var Z=0;((Y=X[Z])!==H);Z++){if((Y===".")||((Y==="")&&(Z>0))){X.splice(Z,1);Z-=1}else{if(Y===".."){if(Z==0){throw"Trying to enter forbidden path space. base: "+aa+" offset: "+ab}X.splice(Z-1,2);Z-=2;if((Z<0)&&(X.length==0)){return V(W,"")}else{Z=0}}}}return V(W,X.join("/"))}function F(W,X){return N(W,X)+"/"}function L(aa){var Z={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}},W=Z.parser.strict.exec(aa),Y={},X=14;while(X--){Y[Z.key[X]]=W[X]||""}Y[Z.q.name]={};Y[Z.key[12]].replace(Z.q.parser,function(ac,ab,ad){if(ab){Y[Z.q.name][ab]=ad}});return Y}function V(W,Y){var X;X=((W.protocol)?(W.protocol+"://"):"");X=X+((W.authority)?W.authority:"");return X+((Y)?Y:((W.directory)?W.directory:""))}function S(W){W=W.split("/");W=W.slice(1,W.length);return W.join("/")}function b(W){W=W.split("/");W=W.slice(0);return W[0]}function l(W){W=W.split("/");W=W.slice(0,W.length-1);return W.join("/")}function E(W){W=W.split("/");W=W.slice(W.length-1);return W[0]}function I(W){return y[o+W]}function O(X,W){return y[o+X]=W}function M(W){return z[o+W]}function j(W,X){return z[o+W]=X}function p(Z,Y,X){Z=(typeof Z=="string")?[Z]:Z;var W={ids:Z,fn:Y,scope:X};if(e(W)){K.push(W);return true}return false}function e(W){if(Q(W.ids,function(aa,X,Z){var Y=I(aa);return(Y!==H&&((Y.state===q)||(Y.state===m)))},this)===H){W.fn.call(W.scope);return false}return true}function t(){var W=[];Q(K,function(X,Z,Y){if(e(X)){W.push(X)}});K=W}function A(W,Y,X){this.parentPackage=W;this.id=Y;this.uri=X;this.state=u;this.exports={};this.factoryFn=null;this.module=null;this.deps=[]}A.prototype={require:function(X){X=(X==="")?X:this.resolveId(X);var W=I(X);if(!W){throw"Module: "+X+" doesn't exist!!"}else{if(!W.createModule()||(W.state===u)||(W.state===v)){throw"Module: "+X+" is not loaded or in error state!!"}}return W.exports},ensure:function(aa,W){var X=this.returnRequire(),Z=(W===H)?function(){}:function(){W.call(null,X)};if(aa===H){aa=[]}for(var Y=0;aa[Y];Y++){aa[Y]=this.resolveId(aa[Y])}if(p(aa,Z,this)){this.parentPackage.loadModules(result)}return H},resolveId:function(X){if(X.indexOf(s)!==-1){return X}var W=this.id.substring(this.id.indexOf(s)+1);X=(X.charAt(0)===".")?N(l(W),X):N("",X);X=this.parentPackage.resolveMapping(X);return(X.id)?X.pPackage.uid+s+X.id:""},resolveDependencies:function(){var Y=this.deps,W;if(Y.length>0){var X;for(W=0;X=Y[W];W++){X=this.resolveId(X);Y[W]=X;if(!I(X)){this.parentPackage.loadModules(X)}}}this.setState(c)},checkDependencyState:function(W){var Z,X;W=(W)?W:{};if((this.state===q)||(this.state===m)||(this.state===v)||W[o+this.id]){return true}if((this.state===u)||(this.state===k)||(this.state===C)){return false}W[o+this.id]=true;for(X=0;Z=this.deps[X];X++){var Y=I(Z);if(Y===H){return false}else{if(Y.state!==q){if(!Y.checkDependencyState(W)){return false}}}}delete W[o+this.id];this.setState(q);return true},createModule:function(){if(this.state===q){this.setState(m);U(this.exports,this.factoryFn.call(null,this.returnRequire(),this.exports,this.returnModule()))}return(this.state===m)?this:null},returnRequire:function(){var X=this,W=function(){return X.require.apply(X,arguments)};W.ensure=function(){return X.ensure.apply(X,arguments)};W.main=(x.mainId)?I(x.mainId).returnModule():{id:"",uri:""};return W},returnModule:function(){if(!this.module){this.module={id:this.id,uri:this.uri}}return this.module},define:function(X,W){this.setState(k);this.deps=X;this.factoryFn=W},setState:function(W){this.state=W}};function i(W,X){this.uid=W;this.uri=X;this.moduleUri=X;j(W,this);this.path={};this.mappings={};this.mainId=null;this.state=u}i.prototype={loadPackageDef:function(W){var X;if(W){X=this.addUid(E(W));W=N(this.moduleUri,W+".js")}else{X=this.addUid("package");W=N(this.moduleUri,"package.js")}this.insertScriptTag(X,W,this,this.procesQueues,this)},procesQueues:function(W,X){if(W._done){return}if(!X){if(W._package.uid===this.uid){this.setState(v)}}this.cleanScriptTag(W);this.procesPackageDefs(W);this.procesModQueue(W,true);if((this.mainId!==null)&&!I(this.mainId)){this.loadModules(this.mainId)}},procesPackageDefs:function(W){var X;for(;X=g.pop();){if(T){W=X[1]}W._package.procesPackageCfg(X[0])}},procesPackageCfg:function(W){var X;if(W.uid&&W.uid!==this.uid){this.uid=W.uid;j(W.uid,this)}this.mainId=(W.main)?this.uid+s+W.main:null;if(this.mainId){p(this.mainId,this.startUp,this)}this.moduleUri=(W.directories&&W.directories.lib)?N(this.uri,W.directories.lib):N(this.uri,"lib");f(W.paths,function(Z,Y){this.setPath(Z,F(this.moduleUri,Y))},this);f(W.mappings,function(Z,aa){var Y={};Y.uri=(aa.location)?F(this.uri,aa.location):"";Y.uid=(aa.uid)?aa.uid:Y.uri;this.setMapping(Z,Y);if(!M(Y.uid)){if(Y.uri===""){throw"No mapping location for package: "+this.uid+" and mapping: "+Z}(new i(Y.uid,Y.uri)).loadPackageDef()}},this);return this},procesModQueue:function(W,Z){var Y,ac,aa,X,ab=W._moduleId;for(X=0;Y=J[X];X++){if(T&&(Y[3]!==null)){W=Y[3]}aa=W._package;if(Y[0]){ac=aa.addUid(Y[0])}else{ac=W._moduleId}if(!I(ac)){O(ac,new A(aa,ac,W.src))}if(I(ac).state===u){I(ac).define(Y[1],Y[2])}}J=[];if(!Z||((I(ab))&&(I(ab).state===u))){if(I(ab)){I(ab).setState(v)}}if(n.length==0){f(y,function(ae,ad){if(ad.state===k){ad.resolveDependencies()}})}f(y,function(ae,ad){if(ad.state===c){ad.checkDependencyState()}});t()},startUp:function(){var W=I(this.mainId);if(W){W.createModule()}},setState:function(W){this.state=W},addUid:function(W){return this.uid+s+W},searchPath:function(W){W=W.substring(W.indexOf(s)+1);return(this.getPath(W))?N(this.getPath(W),E(W)):N(this.moduleUri,W)},getPath:function(W){return this.path[o+W]},setPath:function(X,W){return this.path[o+X]=W},getMapping:function(W){return this.mappings[o+W]},setMapping:function(X,W){return this.mappings[o+X]=W},loadModules:function(Y){var aa,W,Z,X;Y=(typeof Y=="string")?[Y]:Y;for(;aa=Y.pop();){if(!I(aa)){W=this.resolvePackage(aa);Z=W.searchPath(aa);X=O(aa,new A(W,aa,l(Z)));this.insertScriptTag(aa,Z+".js",W,W.procesQueues,W)}}},resolvePackage:function(W){W=W.substring(0,W.indexOf(s));return M(W)},resolveMapping:function(Y){Y=Y.substring(Y.indexOf(s)+1);var W={pPackage:this,id:Y},X;if(X=this.getMapping(b(Y))){Y=S(Y);W=M(X.uid).resolveMapping(Y)}else{if(Y===""){W.id=(this.mainId)?this.mainId.substring(this.mainId.indexOf(s)+1):null}}return W},insertScriptTag:function(ab,Z,aa,W,Y){var X=h.createElement("script");X._moduleId=ab;X._package=aa;X._timer=setTimeout(this.scriptTimer(X,W,Y),R);X.type="text/javascript";X.onload=X.onreadystatechange=this.scriptLoad(X,W,Y);X.onerror=this.scriptError(X,W,Y);X.src=Z;n.push(X);D.insertBefore(X,D.firstChild)},cleanScriptTag:function(W){W._done=true;W.onload=W.onreadystatechange=new Function("");W.onerror=new Function("");if(W._timer){clearTimeout(W._timer)}Q(n,function(Y,X){if(W===Y){n.splice(X,1)}})},scriptLoad:function(X,W,Y){return function(){if(X._done||(typeof X.readyState!="undefined"&&!((X.readyState=="loaded")||(X.readyState=="complete")))){return}W.call(Y,X,true)}},scriptError:function(X,W,Y){return function(){W.call(Y,X,false)}},scriptTimer:function(X,W,Y){return function(){X._timer=0;W.call(Y,X,false)}}};function d(ab,aa,Y){var W=/(\/\*([\s\S]*?)\*\/|\/\/(.*)$)/mg;var Z=/require\(["']([\w-_\.\/]+)["']\)/g;if(typeof ab!=="string"){Y=aa;aa=ab;ab=null}if(!w(aa)){Y=aa;aa=[]}if(!name&&!aa.length&&(typeof Y==="function")){Y.toString().replace(W,"").replace(Z,function(ac,ad){aa.push(ad)})}var X=null;if(T){Q(n,function(ac){if(ac.readyState==="interactive"){X=ac;return false}})}J.push([ab,aa,Y,X])}function P(W){var X=null;if(T){Q(n,function(Y){if(Y.readyState==="interactive"){X=Y;return false}})}g.push([W,X])}function G(Y){var X=document.getElementsByTagName("script"),Z,ac,ad,W,aa,ab={main:null,mainFunction:null,deps:[],location:"",directories:{lib:"./lib"},debug:true,waitSeconds:6000,baseUrlMatch:/apprequire\.js/i},Y=(typeof Y=="object")?Y:ab;U(Y,ab);R=Y.waitSeconds;for(aa=X.length-1;aa>-1&&(Z=X[aa]);aa--){ac=Z.getAttribute("data-main");ad=Z.src;if(ad){W=ad.match(Y.baseUrlMatch);if(W){break}}}if(ac){if(ac.charAt(ac.length)==="/"){ad=ac;ac=null}else{ad=l(ac);ac=E(ac)}ad=N(l(a.location.href),ad)}else{ad=F(l(a.location.href),Y.location)}x=new i("commonjs.org",ad);B(Y.debug);if(ac){x.loadPackageDef(ac)}else{x.procesPackageCfg(Y);if((Y.main!==null)&&(Y.mainFunction!==null)){d(Y.main,Y.deps,Y.mainFunction);x.procesModQueue({_package:x,_moduleId:Y.main,src:a.location.href},true)}else{if(Y.main!==null){x.loadModules(x.mainId)}}}}function B(W){var X=a.require={};X["package"]=P;a.module={};a.module.declare=d;if(W){a.module.modules=y;a.module.packages=z;a.module.deferred=K}a.define=d}if(typeof a.require!=="function"){G((typeof a.require!=="undefined")?a.require:{})}}).call(typeof window==="undefined"?this:window);
