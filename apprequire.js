/**
 * AppRequire - http://code.tolsma.net/apprequire
 * Copyright(c) 2010 Sander Tolsma/TTC
 * licensing@tolsma.net
 * http://code.tolsma.net/licenses
 */
(function(){var a=this,F,h=a.document,B=h.getElementsByTagName("head")[0]||h.getElementsByTagName("body")[0],R=!!a.ActiveXObject,o="_",s="LOADING",k="LOADED",c="DEPENDENCY",q="DEFINED",m="READY",t="LOADERROR",A="WAITING",w={},x={},P,n=[],H=[],g=[],v=null,I=[];function u(V){var U=Object.prototype.toString;return U.apply(V)==="[object Array]"}function r(V,U){return V===null||V===undefined||((u(V)&&!V.length))||(!U?V==="":false)}function O(Y,X,W){if(r(Y,true)){return}for(var V=0,U=Y.length;V<U;V++){if(X.call(W||Y[V],Y[V],V,Y)===false){return V}}}function f(W,V,U){if(r(W)){return}if(u(W)||W.callee){O(W,V,U);return}else{if(typeof W=="object"){for(var X in W){if(W.hasOwnProperty(X)){if(V.call(U||W,X,W[X],W)===false){return}}}}}}function S(W,V,U){for(var X in V){if(!(X in W)||U){W[X]=V[X]}}}function L(Y,Z){if((Z.charAt(Z.length-1)==="/")&&(Z.length>1)){Z=Z.substr(0,Z.length-1)}var U=J(Y),V,W;if(Z.charAt(0)==="/"){return T(U,Z)}V=J(Z);V.directory="";if(T(V,"")!==""){return Z}V=(U.path==="")?[]:U.path.split("/");V=V.concat(Z.split("/"));for(var X=0;((W=V[X])!==F);X++){if((W===".")||((W==="")&&(X>0))){V.splice(X,1);X-=1}else{if(W===".."){if(X==0){throw"Trying to enter forbidden path space. base: "+Y+" offset: "+Z}V.splice(X-1,2);X-=2;if((X<0)&&(V.length==0)){return T(U,"")}else{X=0}}}}return T(U,V.join("/"))}function D(U,V){return L(U,V)+"/"}function J(Y){var X={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}},U=X.parser.strict.exec(Y),W={},V=14;while(V--){W[X.key[V]]=U[V]||""}W[X.q.name]={};W[X.key[12]].replace(X.q.parser,function(aa,Z,ab){if(Z){W[X.q.name][Z]=ab}});return W}function T(U,W){var V;V=((U.protocol)?(U.protocol+"://"):"");V=V+((U.authority)?U.authority:"");return V+((W)?W:((U.directory)?U.directory:""))}function Q(U){U=U.split("/");U=U.slice(1,U.length);return U.join("/")}function b(U){U=U.split("/");U=U.slice(0);return U[0]}function l(U){U=U.split("/");U=U.slice(0,U.length-1);return U.join("/")}function C(U){U=U.split("/");U=U.slice(U.length-1);return U[0]}function G(U){return w[o+U]}function M(V,U){return w[o+V]=U}function K(U){return x[o+U]}function j(U,V){return x[o+U]=V}function p(X,W,V){X=(typeof X=="string")?[X]:X;var U={ids:X,fn:W,scope:V};if(e(U)){I.push(U);return true}return false}function e(U){var V=O(U.ids,function(Z,W,Y){var X=G(Z);return(X!==F&&((X.state===q)||(X.state===m)))},this);if(V===F){U.fn.call(U.scope);return false}else{return true}}function y(U,W,V){this.parentPackage=U;this.id=W;this.uri=V;this.state=s;this.exports={};this.factoryFn=null;this.module=null;this.deps=[]}y.prototype={require:function(V){V=(V==="")?V:this.resolveId(V);var U=G(V);if(!U){throw"Module: "+V+" doesn't exist!!"}else{if(!U.createModule()||(U.state===s)||(U.state===t)){throw"Module: "+V+" is not loaded or in error state!!"}}return U.exports},ensure:function(Y,U){var V=this.returnRequire(),X=(U===F)?function(){}:function(){U.call(null,V)};if(Y===F){Y=[]}for(var W=0;Y[W];W++){Y[W]=this.resolveId(Y[W])}if(p(Y,X,this)){this.parentPackage.loadModules(result)}return F},resolveId:function(V){if(V.indexOf("!")!==-1){return V}var U=this.id.substring(this.id.indexOf("!")+1);V=(V.charAt(0)===".")?L(l(U),V):L("",V);V=this.parentPackage.resolveMapping(V);return(V.id)?V.pPackage.uid+"!"+V.id:""},resolveDependencies:function(){var W=this.deps,U;if(W.length>0){var V;for(U=0;V=W[U];U++){V=this.resolveId(V);W[U]=V;if(!G(V)){this.parentPackage.loadModules(V)}}}this.setState(c)},checkDependencyState:function(U){var X,V;U=(U)?U:{};if((this.state===q)||(this.state===m)||(this.state===t)||U[o+this.id]){return true}if((this.state===s)||(this.state===k)||(this.state===A)){return false}U[o+this.id]=true;for(V=0;X=this.deps[V];V++){var W=G(X);if(W===F){return false}else{if(W.state!==q){if(!W.checkDependencyState(U)){return false}}}}delete U[o+this.id];this.setState(q);return true},createModule:function(){if(this.state===q){this.setState(m);S(this.exports,this.factoryFn.call(null,this.returnRequire(),this.exports,this.returnModule()))}return(this.state===m)?this:null},returnRequire:function(){var V=this,U=function(){return V.require.apply(V,arguments)};U.ensure=function(){return V.ensure.apply(V,arguments)};U.main=(v.mainId)?G(v.mainId).returnModule():{id:"",uri:""};return U},returnModule:function(){if(!this.module){this.module={id:this.id,uri:this.uri}}return this.module},define:function(V,U){this.setState(k);this.deps=V;this.factoryFn=U},setState:function(U){this.state=U}};function i(U,V){this.uid=U;this.uri=V;this.moduleUri=V;j(U,this);this.path={};this.mappings={};this.mainId=null;this.state=s}i.prototype={loadPackageDef:function(U){var V;if(U){V=this.addUid(C(U));U=L(this.moduleUri,U+".js")}else{V=this.addUid("package");U=L(this.moduleUri,"package.js")}this.insertScriptTag(V,U,this,this.procesQueues,this)},procesQueues:function(U,V){if(U._done){return}if(!V){if(U._package.uid===this.uid){this.setState(t)}}this.cleanScriptTag(U);this.procesPackageDefs(U);this.procesModQueue(U,true);if((this.mainId!==null)&&!G(this.mainId)){this.loadModules(this.mainId)}},procesPackageDefs:function(U){var V;for(;V=g.pop();){if(R){U=V[1]}U._package.procesPackageCfg(V[0])}},procesPackageCfg:function(U){var V;if(U.uid&&U.uid!==this.uid){this.uid=U.uid;j(U.uid,this)}this.mainId=(U.main)?this.uid+"!"+U.main:null;if(this.mainId){p(this.mainId,this.startUp,this)}this.moduleUri=(U.directories&&U.directories.lib)?L(this.uri,U.directories.lib):L(this.uri,"lib");f(U.paths,function(X,W){this.setPath(X,D(this.moduleUri,W))},this);f(U.mappings,function(X,Y){var W={};W.uri=(Y.location)?D(this.uri,Y.location):"";W.uid=(Y.uid)?Y.uid:W.uri;this.setMapping(X,W);if(!K(W.uid)){if(W.uri===""){throw"No mapping location for package: "+this.uid+" and mapping: "+X}(new i(W.uid,W.uri)).loadPackageDef()}},this);return this},procesModQueue:function(U,Y){var X,ab,Z,V,aa=U._moduleId;for(V=0;X=H[V];V++){if(R&&(X[3]!==null)){U=X[3]}Z=U._package;if(X[0]){ab=Z.addUid(X[0])}else{ab=U._moduleId}if(!G(ab)){M(ab,new y(Z,ab,U.src))}if(G(ab).state===s){G(ab).define(X[1],X[2])}}H=[];if(!Y||((G(aa))&&(G(aa).state===s))){if(G(aa)){G(aa).setState(t)}}if(n.length==0){f(w,function(ad,ac){if(ac.state===k){ac.resolveDependencies()}})}f(w,function(ad,ac){if(ac.state===c){ac.checkDependencyState()}});var W=[];O(I,function(ac,ae,ad){if(e(ac)){W.push(ac)}});I=W},startUp:function(){var U=G(this.mainId);if(U){U.createModule()}},setState:function(U){this.state=U},addUid:function(U){return this.uid+"!"+U},searchPath:function(U){U=U.substring(U.indexOf("!")+1);return(this.getPath(U))?L(this.getPath(U),C(U)):L(this.moduleUri,U)},getPath:function(U){return this.path[o+U]},setPath:function(V,U){return this.path[o+V]=U},getMapping:function(U){return this.mappings[o+U]},setMapping:function(V,U){return this.mappings[o+V]=U},loadModules:function(W){var Y,U,X,V;W=(typeof W=="string")?[W]:W;for(;Y=W.pop();){if(!G(Y)){U=this.resolvePackage(Y);X=U.searchPath(Y);V=M(Y,new y(U,Y,l(X)));this.insertScriptTag(Y,X+".js",U,U.procesQueues,U)}}},resolvePackage:function(U){U=U.substring(0,U.indexOf("!"));return K(U)},resolveMapping:function(W){W=W.substring(W.indexOf("!")+1);var U={pPackage:this,id:W},V;if(V=this.getMapping(b(W))){W=Q(W);U=K(V.uid).resolveMapping(W)}else{if(W===""){U.id=(this.mainId)?this.mainId.substring(this.mainId.indexOf("!")+1):null}}return U},insertScriptTag:function(Z,X,Y,U,W){var V=h.createElement("script");V._moduleId=Z;V._package=Y;V._timer=setTimeout(this.scriptTimer(V,U,W),P);V.type="text/javascript";V.onload=V.onreadystatechange=this.scriptLoad(V,U,W);V.onerror=this.scriptError(V,U,W);V.src=X;n.push(V);B.insertBefore(V,B.firstChild)},cleanScriptTag:function(U){U._done=true;U.onload=U.onreadystatechange=new Function("");U.onerror=new Function("");if(U._timer){clearTimeout(U._timer)}O(n,function(W,V){if(U===W){n.splice(V,1)}})},scriptLoad:function(V,U,W){return function(){if(V._done||(typeof V.readyState!="undefined"&&!((V.readyState=="loaded")||(V.readyState=="complete")))){return}U.call(W,V,true)}},scriptError:function(V,U,W){return function(){U.call(W,V,false)}},scriptTimer:function(V,U,W){return function(){V._timer=0;U.call(W,V,false)}}};function d(Z,Y,W){var U=/(\/\*([\s\S]*?)\*\/|\/\/(.*)$)/mg;var X=/require\(["']([\w-_\.\/]+)["']\)/g;if(typeof Z!=="string"){W=Y;Y=Z;Z=null}if(!u(Y)){W=Y;Y=[]}if(!name&&!Y.length&&(typeof W==="function")){W.toString().replace(U,"").replace(X,function(aa,ab){Y.push(ab)})}var V=null;if(R){O(n,function(aa){if(aa.readyState==="interactive"){V=aa;return false}})}H.push([Z,Y,W,V])}function N(U){var V=null;if(R){O(n,function(W){if(W.readyState==="interactive"){V=W;return false}})}g.push([U,V])}function E(W){var V=document.getElementsByTagName("script"),X,aa,ab,U,Y,Z={main:null,mainFunction:null,deps:[],location:"",directories:{lib:"./lib"},debug:true,waitSeconds:6000,baseUrlMatch:/apprequire\.js/i},W=(typeof W=="object")?W:Z;S(W,Z);P=W.waitSeconds;for(Y=V.length-1;Y>-1&&(X=V[Y]);Y--){aa=X.getAttribute("data-main");ab=X.src;if(ab){U=ab.match(W.baseUrlMatch);if(U){break}}}if(aa){if(aa.charAt(aa.length)==="/"){ab=aa;aa=null}else{ab=l(aa);aa=C(aa)}ab=L(l(a.location.href),ab)}else{ab=D(l(a.location.href),W.location)}v=new i("commonjs.org",ab);z(W.debug);if(aa){v.loadPackageDef(aa)}else{v.procesPackageCfg(W);if((W.main!==null)&&(W.mainFunction!==null)){d(W.main,W.deps,W.mainFunction);v.procesModQueue({_package:v,_moduleId:W.main,src:a.location.href},true)}else{if(W.main!==null){v.loadModules(v.mainId)}}}}function z(U){var V=a.require={};V["package"]=N;a.module={};a.module.declare=d;if(U){a.module.modules=w;a.module.packages=x;a.module.deferred=I}a.define=d}if(typeof a.require!=="function"){E((typeof a.require!=="undefined")?a.require:{})}}).call(typeof window==="undefined"?this:window);
